<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Tienda VIP - The Guardians</title>

    <link href="./output.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        body { font-family: 'Rajdhani', sans-serif; }
        .glass-panel {
            background: rgba(28, 28, 28, 0.9);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 215, 0, 0.07);
            transition: all 0.25s ease;
        }
        .glass-panel:hover {
            border-color: #FFD700;
            box-shadow: 0 0 18px rgba(255,215,0,0.18);
            transform: translateY(-4px);
        }
    </style>
    
    <script src="load-navbar.js"></script>
    <link rel="stylesheet" href="navbar-styles.css">
    
    <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>
<body class="bg-guardian-dark text-gray-200">

    <header class="relative h-44 flex items-center justify-center bg-[url('./img/fondo.png')] bg-cover bg-center">
        <div class="absolute inset-0 bg-guardian-dark/75"></div>
        <div class="relative z-10 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-guardian-gold tracking-widest uppercase">Tienda de VIPs</h1>
            <p class="text-gray-300 mt-2">Encuentra el VIP ideal para tu experiencia en The Guardians</p>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-12" id="lista-vips">
        <div class="space-y-4">

            <article class="glass-panel flex items-center gap-6 p-4 rounded-lg border border-gray-800">
                <img src="./img/pase.jpg" alt="Guardians Game Battle Pass" class="w-16 h-16 object-cover rounded shadow-md">
                <div class="flex-1">
                    <h3 class="font-bold text-lg text-guardian-cream">Guardians Game Battle Pass</h3>
                    <p class="text-sm text-gray-400">Contenido exclusivo por temporada.</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold text-guardian-cream">$8.00</div>
                    <button onclick="comprar('Guardians Game Battle Pass', 8, 'battle_pass')" 
                            class="mt-3 inline-flex items-center gap-2 bg-[#0580FF] hover:bg-[#0390FF] text-white font-bold px-4 py-2 rounded shadow transition cursor-pointer">
                        <i class="fas fa-shopping-cart"></i> Comprar
                    </button>
                </div>
            </article>

            <article class="glass-panel flex items-center gap-6 p-4 rounded-lg border border-gray-800">
                <img src="./img/primitiveVip.jpg" alt="Vip Primitive" class="w-16 h-16 object-cover rounded shadow-md">
                <div class="flex-1">
                    <h3 class="font-bold text-lg text-guardian-cream">Vip Primitive</h3>
                    <p class="text-sm text-gray-400">Acceso básico y beneficios de inicio.</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold text-guardian-cream">$5.00</div>
                    <button onclick="comprar('Vip Primitive', 5, 'vip_primitive')" 
                            class="mt-3 inline-flex items-center gap-2 bg-[#0580FF] hover:bg-[#0390FF] text-white font-bold px-4 py-2 rounded shadow transition cursor-pointer">
                        <i class="fas fa-shopping-cart"></i> Comprar
                    </button>
                </div>
            </article>

            <article class="glass-panel flex items-center gap-6 p-4 rounded-lg border border-gray-800">
                <img src="./img/tambaleanteVip.jpg" alt="Vip Tambaleante" class="w-16 h-16 object-cover rounded shadow-md">
                <div class="flex-1">
                    <h3 class="font-bold text-lg text-guardian-cream">Vip Tambaleante</h3>
                    <p class="text-sm text-gray-400">Paquete intermedio con ventajas PvP.</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold text-guardian-cream">$12.00</div>
                    <button onclick="comprar('Vip Tambaleante', 12, 'vip_tambaleante')" 
                            class="mt-3 inline-flex items-center gap-2 bg-[#0580FF] hover:bg-[#0390FF] text-white font-bold px-4 py-2 rounded shadow transition cursor-pointer">
                        <i class="fas fa-shopping-cart"></i> Comprar
                    </button>
                </div>
            </article>

            <article class="glass-panel flex items-center gap-6 p-4 rounded-lg border border-gray-800">
                <img src="https://via.placeholder.com/64x64/111111/FFD700?text=A" alt="Vip Aprendiz" class="w-16 h-16 object-cover rounded shadow-md">
                <div class="flex-1">
                    <h3 class="font-bold text-lg text-guardian-cream">Vip Aprendiz</h3>
                    <p class="text-sm text-gray-400">Ideal para jugadores que suben de nivel.</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold text-guardian-cream">$30.00</div>
                    <button onclick="comprar('Vip Aprendiz', 30, 'vip_aprendiz')" 
                            class="mt-3 inline-flex items-center gap-2 bg-[#0580FF] hover:bg-[#0390FF] text-white font-bold px-4 py-2 rounded shadow transition cursor-pointer">
                        <i class="fas fa-shopping-cart"></i> Comprar
                    </button>
                </div>
            </article>

            <article class="glass-panel flex items-center gap-6 p-4 rounded-lg border border-gray-800">
                <img src="https://via.placeholder.com/64x64/111111/FFD700?text=O" alt="Vip Oficial" class="w-16 h-16 object-cover rounded shadow-md">
                <div class="flex-1">
                    <h3 class="font-bold text-lg text-guardian-cream">Vip Oficial</h3>
                    <p class="text-sm text-gray-400">Rango oficial con perks permanentes.</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold text-guardian-cream">$30.00</div>
                    <button onclick="comprar('Vip Oficial', 30, 'vip_oficial')" 
                            class="mt-3 inline-flex items-center gap-2 bg-[#0580FF] hover:bg-[#0390FF] text-white font-bold px-4 py-2 rounded shadow transition cursor-pointer">
                        <i class="fas fa-shopping-cart"></i> Comprar
                    </button>
                </div>
            </article>

            <article class="glass-panel flex items-center gap-6 p-4 rounded-lg border border-gray-800">
                <img src="https://via.placeholder.com/64x64/111111/FFD700?text=M" alt="Vip Mastercraft" class="w-16 h-16 object-cover rounded shadow-md">
                <div class="flex-1">
                    <h3 class="font-bold text-lg text-guardian-cream">Vip Mastercraft</h3>
                    <p class="text-sm text-gray-400">Artículos Tek y materiales de construcción.</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold text-guardian-cream">$45.00</div>
                    <button onclick="comprar('Vip Mastercraft', 45, 'vip_mastercraft')" 
                            class="mt-3 inline-flex items-center gap-2 bg-[#0580FF] hover:bg-[#0390FF] text-white font-bold px-4 py-2 rounded shadow transition cursor-pointer">
                        <i class="fas fa-shopping-cart"></i> Comprar
                    </button>
                </div>
            </article>

            <article class="glass-panel flex items-center gap-6 p-4 rounded-lg border border-gray-800">
                <img src="https://via.placeholder.com/64x64/111111/FFD700?text=A+" alt="Vip Ascendente" class="w-16 h-16 object-cover rounded shadow-md">
                <div class="flex-1">
                    <h3 class="font-bold text-lg text-guardian-cream">Vip Ascendente</h3>
                    <p class="text-sm text-gray-400">Máximo poder: dinos ascendentes y perks únicos.</p>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold text-guardian-cream">$60.00</div>
                    <button onclick="comprar('Vip Ascendente', 60, 'vip_ascendente')" 
                            class="mt-3 inline-flex items-center gap-2 bg-[#0580FF] hover:bg-[#0390FF] text-white font-bold px-4 py-2 rounded shadow transition cursor-pointer">
                        <i class="fas fa-shopping-cart"></i> Comprar
                    </button>
                </div>
            </article>

            <article class="glass-panel flex items-center gap-6 p-4 rounded-lg border border-gray-800">
                <img src="https://via.placeholder.com/64x64/111111/FFD700?text=F" alt="Gratis Diario" class="w-16 h-16 object-cover rounded shadow-md">
                <div class="flex-1">
                    <h3 class="font-bold text-lg text-guardian-cream">Gratis Diario</h3>
                    <p class="text-sm text-gray-400">Reclama tu recompensa diaria — sin costo.</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-400">Este artículo es gratis.</div>
                </div>
            </article>

        </div>
    </main>

    <script>
        // 1. INICIALIZAR MERCADO PAGO (De forma segura)
        let mp;

        fetch('/api/mp-public-key')
            .then(res => res.json())
            .then(data => {
                mp = new MercadoPago(data.publicKey, {
                    locale: 'es-AR'
                });
                console.log('✅ Mercado Pago inicializado correctamente');
            })
            .catch(error => {
                console.error('❌ Error cargando clave pública:', error);
                alert('Error al cargar el sistema de pagos');
            });

        // 2. FUNCIÓN DE COMPRA
        async function comprar(titulo, precio, itemId) {
            // Verificar Login
            const userJson = localStorage.getItem('currentUser');
            
            if (!userJson) {
                alert("⚠️ DEBES INICIAR SESIÓN");
                return;
            }

            const user = JSON.parse(userJson);
            const btn = event.currentTarget;

            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cargando...';
            btn.disabled = true;

            try {
                const response = await fetch('/crear-orden', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: titulo,
                        price: Number(precio),
                        quantity: 1,
                        itemId: itemId,
                        userId: user.id // Usar ID, no nombre
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || "Error del servidor");
                }

                const preference = await response.json();

                if (preference.init_point) {
                    window.location.href = preference.init_point;
                } else {
                    throw new Error("Mercado Pago no devolvió el link de pago");
                }

            } catch (error) {
                console.error('Error de compra:', error);
                alert(`❌ Error: ${error.message}`);
            } finally {
                btn.innerHTML = '<i class="fas fa-shopping-cart"></i> Comprar';
                btn.disabled = false;
            }
        }
    </script>

</body>
</html>